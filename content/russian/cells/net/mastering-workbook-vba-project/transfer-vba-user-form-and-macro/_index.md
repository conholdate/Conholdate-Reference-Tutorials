---
"description": "Откройте для себя возможности автоматизации Excel с этим подробным руководством по переносу пользовательских форм VBA и макросов между рабочими книгами с помощью Aspose.Cells для .NET. Идеально подходит как для новичков, так и для опытных разработчиков."
"linktitle": "Перенос пользовательских форм и макросов VBA между рабочими книгами Excel"
"second_title": "API обработки Excel Aspose.Cells .NET"
"title": "Перенос пользовательских форм и макросов VBA между рабочими книгами Excel"
"url": "/ru/cells/net/mastering-workbook-vba-project/transfer-vba-user-form-and-macro/"
"weight": 11
---

## Введение

Добро пожаловать в полное руководство по улучшению работы с Excel с помощью макросов VBA и пользовательских форм! В этом руководстве мы рассмотрим, как перенести конструктор пользовательских форм VBA Macro UserForm Designer из одной книги в другую с помощью мощной библиотеки Aspose.Cells для .NET. Независимо от того, являетесь ли вы опытным разработчиком или новичком, это пошаговое руководство поможет вам освоить программную обработку файлов Excel. Готовы к работе? Начнём!

## Предпосылки
Прежде чем приступить к кодированию, давайте убедимся, что у вас есть все необходимое:

1. Среда разработки C#: рабочая среда для разработки на C#, настоятельно рекомендуется использовать Visual Studio.
2. Библиотека Aspose.Cells для .NET: обязательно интегрируйте библиотеку Aspose.Cells в свой проект. Вы можете легко [скачать здесь](https://releases.aspose.com/cells/net/).
3. Базовые знания VBA и макросов Excel: знакомство с VBA и принципами работы макросов Excel улучшит ваше понимание этого руководства.
4. Файл Excel с формой пользователя: создайте или получите книгу Excel, содержащую форму пользователя (желательно с включенными макросами, например `.xlsm` файлы).

## Импорт необходимых пакетов
Чтобы использовать функциональные возможности Aspose.Cells, включите следующие пространства имен в начало файла C#:

```csharp
using System;
using Aspose.Cells;
using Aspose.Cells.Vba;
```

Эти пространства имен предоставят вам доступ к мощным инструментам, встроенным в библиотеку Aspose.Cells.

## Шаг 1: Определите исходный и выходной каталоги
Сначала определите местоположение ваших файлов:

```csharp
// Определите исходный и выходной каталоги
string sourceDir = @"Your\Source\Directory\";
string outputDir = @"Your\Output\Directory\";
```

Замените пути-заполнители фактическими каталогами, в которых хранятся ваши файлы.

## Шаг 2: Создайте пустую целевую рабочую книгу
Затем создайте новую книгу, в которую вы скопируете пользовательскую форму и макросы:

```csharp
// Создать пустую целевую книгу
Workbook target = new Workbook();
```

Это приведет к созданию пустой книги, которая послужит основой для предстоящей передачи данных.

## Шаг 3: Загрузите шаблон рабочей книги
Загрузите рабочую книгу, содержащую вашу пользовательскую форму и макросы:

```csharp
// Загрузите файл Excel, содержащий пользовательскую форму VBA-Macro Designer.
Workbook templateFile = new Workbook(sourceDir + "sampleDesignerForm.xlsm");
```

Регулировать `"sampleDesignerForm.xlsm"` на имя вашего фактического файла.

## Шаг 4: Копирование рабочих листов в целевую книгу
Теперь давайте скопируем рабочие листы из шаблона в целевую книгу:

```csharp
// Копировать все шаблоны рабочих листов в целевую книгу
foreach (Worksheet ws in templateFile.Worksheets)
{
    if (ws.Type == SheetType.Worksheet)
    {
        Worksheet s = target.Worksheets.Add(ws.Name);
        s.Copy(ws);
        // Добавьте сообщение в ячейку A2 целевого листа.
        s.Cells["A2"].PutValue("VBA Macro and User Form copied from template to target.");
    }
}
```

Этот код проходит по каждому рабочему листу в шаблоне и копирует его в целевую книгу, гарантируя бесперебойную передачу всех данных.

## Шаг 5: Скопируйте макросы VBA из шаблона
Далее мы скопируем макросы VBA, включая модули UserForm Designer, в новую книгу:

```csharp
// Копировать пользовательскую форму VBA-Macro Designer из шаблона в целевой объект
foreach (VbaModule vbaItem in templateFile.VbaProject.Modules)
{
    if (vbaItem.Name == "ThisWorkbook")
    {
        // Скопировать код модуля ThisWorkbook
        target.VbaProject.Modules["ThisWorkbook"].Codes = vbaItem.Codes;
    }
    else
    {
        // Копировать код и данные других модулей
        int vbaMod = target.VbaProject.Modules.Add(vbaItem.Type, vbaItem.Name);
        target.VbaProject.Modules[vbaMod].Codes = vbaItem.Codes;

        if (vbaItem.Type == VbaModuleType.Designer)
        {
            // Получить хранилище конструктора пользовательских форм
            byte[] designerStorage = templateFile.VbaProject.Modules.GetDesignerStorage(vbaItem.Name);
            // Добавьте хранилище конструктора в целевой проект VBA.
            target.VbaProject.Modules.AddDesignerStorage(vbaItem.Name, designerStorage);
        }
    }
}
```

Этот код гарантирует, что копируется не только код, но и дизайн пользовательской формы, сохраняя при этом функциональность ваших макросов.

## Шаг 6: Сохраните целевую рабочую книгу
После завершения процесса копирования сохраните новую книгу:

```csharp
// Сохраните целевую книгу
target.Save(outputDir + "outputDesignerForm.xlsm", SaveFormat.Xlsm);
```

При необходимости измените имя выходного файла. На этом этапе будет создана персонализированная книга, заполненная макросами и пользовательскими формами.

## Шаг 7: Подтвердите успех
Наконец, выведите на консоль сообщение об успешном завершении:

```csharp
Console.WriteLine("CopyVBAMacroUserFormDesignerStorageToWorkbook executed successfully.\r\n");
```

Эта простая строка заверит вас, что процесс прошел гладко, — важное подтверждение вашей упорной работы!

## Заключение
Поздравляем! Вы успешно научились копировать конструктор пользовательских форм VBA-макросов из одной книги в другую с помощью Aspose.Cells для .NET. Хотя поначалу это может показаться сложным, практика поможет вам освоить работу с книгами. Помните, что программирование — это эксперимент, поэтому не стесняйтесь исследовать различные функции в файлах Excel. Если у вас есть вопросы или вам нужна помощь, форумы и документация Aspose — отличные ресурсы для получения поддержки.

## Часто задаваемые вопросы

### Какие версии Excel поддерживает Aspose.Cells?
Aspose.Cells поддерживает различные форматы Excel, включая XLSX, XLSM, CSV и другие.

### Могу ли я использовать Aspose.Cells бесплатно?
Да! Вы можете начать с бесплатной пробной версии, чтобы оценить библиотеку: [Бесплатная пробная версия](https://releases.aspose.com/).

### Нужна ли мне Visual Studio для запуска этого кода?
Хотя Visual Studio рекомендуется использовать из-за его удобных для пользователя функций, подойдет любая IDE C#, поддерживающая разработку .NET.

### Где я могу найти больше примеров и документации?
Вы можете исследовать [Документация Aspose.Cells](https://reference.aspose.com/cells/net/) для получения дополнительных примеров и подробных объяснений.

### Как решить проблемы при использовании Aspose.Cells?
Вам следует посетить [Форум поддержки Aspose](https://forum.aspose.com/c/cells/9) за помощь от сообщества и службы поддержки Aspose.